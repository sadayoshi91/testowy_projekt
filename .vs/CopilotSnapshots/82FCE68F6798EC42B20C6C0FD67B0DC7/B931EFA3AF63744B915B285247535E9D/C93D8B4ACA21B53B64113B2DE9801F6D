import React from 'react';
import { Office } from '../../models/office';
import { Employee } from '../../models/employee';

interface OfficeMapProps {
  offices: Office[];
  employees: Employee[];
  darkMode?: boolean;
  onRent?: (officeId: string) => void;
}

const getInitials = (name?: string) => {
  if (!name) return '?';
  const parts = name.trim().split(' ');
  if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();
  return (parts[0][0] + parts[1][0]).toUpperCase();
};

export const OfficeMap: React.FC<OfficeMapProps> = ({ offices, employees, darkMode, onRent }) => {
  return (
    <div className={`office-map${darkMode ? ' dark' : ''}`}>
      {offices.map(office => {
        const desks = office.desks || [];
        return (
          <div key={office.id} className="office-card">
            <header>
              <div>
                <div style={{ fontWeight: 700 }}>{office.name}</div>
                <small style={{ opacity: 0.7 }}>Rent: {office.rent}</small>
              </div>
              <div className="office-badge">
                {office.owned ? 'ACTIVE' : 'FOR RENT'}
              </div>
            </header>
            {!office.owned && onRent && (
              <button
                style={{
                  padding: '6px 12px',
                  borderRadius: 999,
                  border: 'none',
                  background: '#5c6ef8',
                  color: '#fff',
                  cursor: 'pointer',
                  marginBottom: 12,
                  fontWeight: 600,
                }}
                onClick={() => onRent(office.id)}
              >
                Rent this office
              </button>
            )}
            <div className="desk-grid">
              {desks.map((desk, index) => {
                const occupant = employees.find(e => e.id === desk.assignedEmployeeId);
                return (
                  <div key={desk.id} className="desk-cell">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                      <span style={{ fontSize: '0.8rem', fontWeight: 600 }}>Desk {index + 1}</span>
                      {occupant && <span className="employee-bubble">{getInitials(occupant.name)}</span>}
                    </div>
                    <div className="desk-label">
                      {occupant ? occupant.name : 'Unassigned'}
                    </div>
                    {occupant && (
                      <div style={{ fontSize: '0.75rem', opacity: 0.7 }}>{occupant.role}</div>
                    )}
                  </div>
                );
              })}
              {desks.length === 0 && (
                <div className="desk-cell" style={{ justifyContent: 'center', alignItems: 'center' }}>
                  <div style={{ opacity: 0.6 }}>No desks defined</div>
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  );
};
